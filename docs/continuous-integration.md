1. [Continuous integration and deployment](#continuous-integration-and-deployment)
    1. [GitLab CI](#gitlab-ci)
    2. [Codeship](#codeship)
    3. [Bitbucket Pipelines](#bitbucket-pipelines)
    4. [Travis CI](#travis-ci)
    5. [CircleCI](#circleci)
    6. [AppVeyor](#appveyor)


# Continuous integration and deployment

Here are some examples on how to add a continuous integration and deployment service to your project.


## GitLab CI

1. _wip_
2. (Optional) Add a status badge to your README.md
```
[![pipeline status](https://gitlab.com/simonknittel/static-site-generator-mirror/badges/master/pipeline.svg)](https://gitlab.com/simonknittel/static-site-generator-mirror/commits/master)
```

### Mirror

I use [this](https://gitlab.com/simonknittel/static-site-generator-mirror) mirror of the repository over on GitLab to test the GitLab CI configuration.


## Codeship

1. Add the following to the `Setup Commands`:

```shell
echo "//npm.pkg.github.com/:_authToken=${CODESHIP_READ_PACKAGES}" >> .npmrc
nvm install 12
npm ci
```

2. Add the following to `Configure Test Pipelines`:

_The configuration for Sentry/Raven.js makes only sense when you are using the branching and release worklfow defined [here](./branching-and-release-workflow.md)_

```shell
RAVEN_ENVIRONMENT="$CI_BRANCH" # Name of current branch
RAVEN_COMMIT="$(git describe --tags)" # Something like v1.0.0 or v1.0.0-1
RAVEN_RELEASE="$RAVEN_COMMIT" # Will be the tag itself when merge to master/production branch

sed -i "s/environment: 'development'/environment: '$RAVEN_ENVIRONMENT'/g" ./src/_templates/base.pug
sed -i "s/\/\/ tags: { git_commit: '' },/tags: { git_commit: '$RAVEN_COMMIT' },/g" ./src/_templates/base.pug

if [ "$RAVEN_ENVIRONMENT" = "master" ]; then sed -i "s/\/\/ release: '',/release: '$RAVEN_RELEASE'/g" ./src/_templates/base.pug; fi

npm test
```

3. Add `Deployment Pipelines` for your branches:

```shell
ssh username@host "mkdir -p ~/new_codeship.static-site-generator.simonknittel.de"
rsync -r dist/ username@host:~/new_codeship.static-site-generator.simonknittel.de
ssh username@host "mv ~/codeship.static-site-generator.simonknittel.de ~/old_codeship.static-site-generator.simonknittel.de || true"
ssh username@host "mv ~/new_codeship.static-site-generator.simonknittel.de ~/codeship.static-site-generator.simonknittel.de"
ssh username@host "rm -rf ~/old_codeship.static-site-generator.simonknittel.de || true"
ssh username@host "cd ~/codeship.static-site-generator.simonknittel.de/ && find -type d -exec chmod 755 {} \; && find -type f -exec chmod 644 {} \;"
```

4. Add environmental variable called `CODESHIP_READ_PACKAGES` with Personal access token generated by GitHub

5. (Optional) Add a status badge to your README.md (see <https://codeship.com/documentation/faq/codeship-badge/>)


## Bitbucket Pipelines

_wip_


## Travis CI

1. Enable your repository in Travis CI
2. Activate the setting: `Build only if .travis.yml is present`
3. (Optional) Add a status badge to your README.md (see <https://docs.travis-ci.com/user/status-images/>)

_wip_


## CircleCI

1. Add your project under <https://circleci.com/add-projects>
2. (Optional) Add a status badge to your README.md (see <https://circleci.com/docs/status-badges/>)

_wip_


## AppVeyor

1. Check `Skip branches without appveyor.yml` under `Settings > General`

_wip_
